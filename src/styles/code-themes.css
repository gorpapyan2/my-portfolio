/* Enhanced GitHub-style code block styling with dual-theme support */

/* Code block wrapper (from rehype-pretty-code) */
.prose .code-block-wrapper {
  @apply relative my-6;
}

/* Ensure pre elements with wrapper class are also relative */
.prose pre.code-block-wrapper {
  @apply relative my-6;
}

/* Code title (figcaption) */
.prose [data-rehype-pretty-code-title] {
  @apply px-4 py-2 text-sm font-mono text-gray-300 bg-gray-800/50 border border-gray-700 rounded-t-2xl border-b-0;
}

.light .prose [data-rehype-pretty-code-title] {
  @apply text-gray-700 bg-gray-100/80 border-gray-300;
}

/* Code block container */
.prose pre {
  @apply relative overflow-x-auto rounded-2xl border border-gray-700 shadow-lg my-0;
  padding: 1rem;
  background: rgba(0, 0, 0, 0.4) !important;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
}

.light .prose pre {
  @apply border-gray-300 shadow-md;
  background: rgba(255, 255, 255, 0.8) !important;
}

/* Round only top corners if title exists */
.prose [data-rehype-pretty-code-title] + pre {
  @apply rounded-t-none;
}

/* Code content */
.prose pre code {
  @apply block text-sm leading-relaxed;
  background: transparent !important;
  color: inherit !important;
  padding: 0;
  counter-reset: line;
  display: grid;
}

/* Individual code lines */
.prose pre code > [data-line] {
  @apply px-4 border-l-2 border-transparent;
  display: inline-block;
  min-height: 1.5rem;
  width: 100%;
}

/* Line numbers using CSS counter */
.prose pre code[data-line-numbers] > [data-line]::before {
  counter-increment: line;
  content: counter(line);
  display: inline-block;
  width: 2ch;
  margin-right: 1.5rem;
  text-align: right;
  color: rgba(255, 255, 255, 0.4);
}

.light .prose pre code[data-line-numbers] > [data-line]::before {
  color: rgba(0, 0, 0, 0.4);
}

/* Highlighted lines */
.prose pre code [data-highlighted-line] {
  background: rgba(255, 255, 255, 0.08);
  border-left-color: rgb(var(--accent));
}

.light .prose pre code [data-highlighted-line] {
  background: rgba(0, 0, 0, 0.05);
  border-left-color: rgb(var(--accent));
}

/* Highlighted characters/words */
.prose pre code .word {
  @apply bg-gray-700/50 border border-gray-600 rounded px-1;
}

.light .prose pre code .word {
  @apply bg-gray-200/70 border-gray-400;
}

/* Diff markers */
.prose pre code [data-line][data-diff="add"] {
  background: rgba(34, 197, 94, 0.15);
  border-left-color: rgb(34, 197, 94);
}

.prose pre code [data-line][data-diff="remove"] {
  background: rgba(239, 68, 68, 0.15);
  border-left-color: rgb(239, 68, 68);
  opacity: 0.7;
}

/* Inline code styling */
.prose code:not(pre code) {
  @apply px-1.5 py-0.5 text-sm font-mono bg-gray-800/60 text-accent rounded border border-gray-700;
}

.light .prose code:not(pre code) {
  @apply bg-gray-200 text-gray-800 border-gray-300;
}

/* Scrollbar styling for code blocks */
.prose pre::-webkit-scrollbar {
  height: 8px;
}

.prose pre::-webkit-scrollbar-track {
  @apply bg-gray-900/50 rounded;
}

.light .prose pre::-webkit-scrollbar-track {
  @apply bg-gray-200/50;
}

.prose pre::-webkit-scrollbar-thumb {
  @apply bg-gray-600 rounded;
}

.prose pre::-webkit-scrollbar-thumb:hover {
  @apply bg-gray-500;
}

.light .prose pre::-webkit-scrollbar-thumb {
  @apply bg-gray-400;
}

.light .prose pre::-webkit-scrollbar-thumb:hover {
  @apply bg-gray-500;
}

/* Focus styles for accessibility */
.prose pre:focus-within {
  @apply ring-2 ring-accent ring-opacity-50;
}

/* Copy button container */
.copy-button-container {
  @apply absolute top-0 right-0;
}

/* Responsive adjustments */
@media (max-width: 640px) {
  .prose pre {
    @apply text-xs rounded-xl;
    padding: 0.75rem;
  }
  
  .prose pre code > [data-line] {
    @apply px-2;
  }

  .prose pre code[data-line-numbers] > [data-line]::before {
    width: 1.5ch;
    margin-right: 1rem;
  }
  
  .prose [data-rehype-pretty-code-title] {
    @apply px-3 py-1.5 text-xs rounded-t-xl;
  }
}
