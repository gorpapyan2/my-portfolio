import{r as c,j as e,w as x}from"./index-siMbvs9L.js";import{A as h,a as v}from"./cv.schema-DOuOHXoZ.js";import{A as j}from"./AnimatedGridBackground-ziJYardy.js";import N from"./ParticleBackground-BTo_ezha.js";async function g(a){return{ok:!1,message:"Save disabled in production. Export JSON instead."}}async function y(){return{ok:!1,message:"Run `npm run build:cv` in CI or locally."}}function S(a){const l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=URL.createObjectURL(l),s=document.createElement("a");s.href=i,s.download="about.data.json",s.click(),URL.revokeObjectURL(i)}async function A(a){await navigator.clipboard.writeText(JSON.stringify(a,null,2))}function k(a,l,i){const s=new FileReader;s.onload=()=>{try{const n=JSON.parse(String(s.result));l(n)}catch(n){i(n instanceof Error?n.message:"Invalid JSON file.")}},s.onerror=()=>i("Failed to read file."),s.readAsText(a)}const b=JSON.stringify(v,null,2);function E(){const[a,l]=c.useState(""),[i,s]=c.useState(!1),[n,u]=c.useState(b),[p,r]=c.useState(null),d=c.useMemo(()=>{try{return{ok:!0,value:JSON.parse(n)}}catch(t){return{ok:!1,message:t instanceof Error?t.message:"Invalid JSON"}}},[n]),o=c.useMemo(()=>{if(!d.ok)return{success:!1,message:d.message};const t=h.safeParse(d.value);return t.success?{success:!0,data:t.data}:{success:!1,message:t.error.message}},[d]);return e.jsxs(j,{children:[e.jsx(N,{}),e.jsx("div",{className:"relative z-10 p-[var(--space-24)]",children:i?e.jsxs("div",{className:"max-w-5xl mx-auto space-y-[var(--space-24)]",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-[length:var(--font-600)] font-semibold text-[var(--text)]",children:"About/CV Admin"}),e.jsx("p",{className:"text-[length:var(--font-200)] text-[var(--text-muted)]",children:"Edit canonical About data below. Use Export/Import for production updates."})]}),e.jsxs(x,{className:"space-y-[var(--space-12)]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"about-json",children:"About data JSON"}),e.jsx("textarea",{id:"about-json",value:n,onChange:t=>u(t.target.value),rows:22,className:"field font-mono text-xs"})]}),!o.success&&e.jsx("div",{className:"rounded-[var(--radius-md)] border border-red-500/20 bg-red-500/10 p-[var(--space-12)] text-[length:var(--font-100)] text-red-400",children:o.message})]}),e.jsxs("div",{className:"flex flex-wrap gap-[var(--space-8)]",children:[e.jsx("button",{onClick:()=>u(b),className:"btn btn-secondary",children:"Reset"}),e.jsx("button",{onClick:()=>{if(!o.success){r("Fix JSON errors before saving.");return}g(o.data).then(t=>r(t.message))},className:"btn btn-primary",children:"Save (Dev)"}),e.jsx("button",{onClick:()=>{if(!o.success){r("Fix JSON errors before exporting.");return}S(o.data),r("Exported about.data.json")},className:"btn btn-primary",children:"Export JSON"}),e.jsxs("label",{className:"btn btn-secondary cursor-pointer inline-flex items-center",children:["Import JSON",e.jsx("input",{type:"file",accept:"application/json",className:"hidden",onChange:t=>{const f=t.target.files?.[0];f&&k(f,m=>{u(JSON.stringify(m,null,2)),r("Imported JSON.")},m=>r(m))}})]}),e.jsx("button",{onClick:()=>{if(!o.success){r("Fix JSON errors before copying.");return}A(o.data).then(()=>r("Copied JSON to clipboard."))},className:"btn btn-secondary",children:"Copy JSON"}),e.jsx("button",{onClick:()=>{y().then(t=>r(t.message))},className:"btn btn-primary",children:"Rebuild CV"})]}),p&&e.jsx("p",{className:"text-[length:var(--font-100)] text-[var(--text-muted)]",children:p}),e.jsxs(x,{className:"text-[length:var(--font-200)] text-[var(--text-muted)] space-y-[var(--space-8)]",children:[e.jsx("p",{children:"Production workflow:"}),e.jsxs("ol",{className:"list-decimal pl-[var(--space-20)] space-y-[var(--space-4)]",children:[e.jsx("li",{children:"Export JSON and commit to `src/content/about.data.json`."}),e.jsxs("li",{children:["Run ",e.jsx("code",{children:"npm run build:cv"})," in CI to regenerate `docs/CV.md`."]})]})]})]}):e.jsx("div",{className:"flex justify-center",children:e.jsx(x,{className:"w-full max-w-xl",children:e.jsxs("div",{className:"space-y-[var(--space-16)]",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-[length:var(--font-600)] font-semibold text-[var(--text)]",children:"Admin Access"}),e.jsxs("p",{className:"text-[length:var(--font-200)] text-[var(--text-muted)]",children:["Configure ",e.jsx("code",{children:"VITE_ADMIN_KEY"})," at build time. This gate is minimal and not secure for public use."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"admin-key",children:"Admin key"}),e.jsx("input",{id:"admin-key",type:"password",placeholder:"Admin key",value:a,onChange:t=>l(t.target.value),className:"field"})]}),e.jsx("button",{onClick:()=>s(a===""),className:"btn btn-primary inline-flex items-center justify-center",children:"Enter"})]})})})})]})}export{E as AdminPage};
