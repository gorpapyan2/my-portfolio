import{c as y,s as k,t as c,ap as _,_ as w,aq as R,r as n,u as W,j as e,f as A,T as j,am as B}from"./index-siMbvs9L.js";import{P as U}from"./plus-YjYhcHqF.js";import{T as Z}from"./trash-2-ClcjC_9b.js";import{F as $}from"./filter-BJpqqIw5.js";import{a as G}from"./index-B3aSPS-Z.js";import"./code-2-Uh6hYNEL.js";import"./AnimatedGridBackground-ziJYardy.js";import"./ParticleBackground-BTo_ezha.js";const H=y("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);const J=y("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);const Q=y("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),V=k({flag_key:c().min(1,"Flag key is required").max(100,"Flag key must be less than 100 characters"),content_type:w(["section","blog_post","project"],{errorMap:()=>({message:"Content type must be section, blog_post, or project"})}),content_id:c().uuid().nullable().optional(),enabled:_().default(!0),description:c().min(1,"Description is required").max(500,"Description must be less than 500 characters")});k({flag_key:c().min(1,"Flag key is required").max(100,"Flag key must be less than 100 characters").optional(),content_type:w(["section","blog_post","project"],{errorMap:()=>({message:"Content type must be section, blog_post, or project"})}).optional(),content_id:c().uuid().nullable().optional(),enabled:_().optional(),description:c().min(1,"Description is required").max(500,"Description must be less than 500 characters").optional()});function X(){const t=R({tableName:"feature_flags",schema:V,orderBy:"flag_key",orderAscending:!0}),o=n.useCallback(m=>t.data.find(x=>x.flag_key===m)?.enabled??!1,[t.data]);return{featureFlags:t.data,isLoading:t.isLoading,error:t.error,createFeatureFlag:t.create,updateFeatureFlag:t.update,deleteFeatureFlag:t.remove,refreshFeatureFlags:t.refetch,isFeatureEnabled:o}}function ce(){const{t}=W(),{featureFlags:o,isLoading:m,error:p,createFeatureFlag:x,updateFeatureFlag:N,deleteFeatureFlag:C}=X(),[T,u]=n.useState(!1),[S,h]=n.useState(!1),[D,f]=n.useState(!1),[i,l]=n.useState(null),[v,L]=n.useState(""),[g,M]=n.useState("all"),[s,r]=n.useState({flag_key:"",content_type:"section",content_id:"",description:"",enabled:!0}),F=o.filter(a=>{const b=a.flag_key.toLowerCase().includes(v.toLowerCase())||a.description.toLowerCase().includes(v.toLowerCase()),z=g==="all"||a.content_type===g;return b&&z}),E=async()=>{try{const a={flag_key:s.flag_key,content_type:s.content_type,content_id:s.content_id||null,description:s.description,enabled:s.enabled};await x(a),u(!1),d()}catch(a){console.error("Error creating feature flag:",a)}},P=async()=>{if(i)try{const a={flag_key:s.flag_key,content_type:s.content_type,content_id:s.content_id||null,description:s.description,enabled:s.enabled};await N(i.id,a),h(!1),l(null),d()}catch(a){console.error("Error updating feature flag:",a)}},I=async()=>{if(i)try{await C(i.id),f(!1),l(null)}catch(a){console.error("Error deleting feature flag:",a)}},K=async a=>{try{await N(a.id,{enabled:!a.enabled})}catch(b){console.error("Error toggling feature flag:",b)}},q=a=>{l(a),r({flag_key:a.flag_key,content_type:a.content_type,content_id:a.content_id||"",description:a.description,enabled:a.enabled}),h(!0)},O=a=>{l(a),f(!0)},d=()=>{r({flag_key:"",content_type:"section",content_id:"",description:"",enabled:!0})};return m?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(A,{})}):p?e.jsx("div",{className:"text-center text-red-400",children:e.jsxs("p",{children:[e.jsx(j,{translationKey:"error.loadFailed.featureFlags",as:"span",shimmerWidth:"200px"}),": ",p]})}):e.jsxs("div",{className:"stack [--stack-space:var(--space-24)]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-[var(--space-12)]",children:[e.jsx("div",{className:"inline-flex p-[var(--space-8)] rounded-[var(--radius-md)] bg-accent/10 text-accent",children:e.jsx(G,{className:"h-[var(--space-24)] w-[var(--space-24)]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-[length:var(--font-600)] font-bold text-[var(--text)]",children:e.jsx(j,{translationKey:"admin.featureFlags.title",as:"span",shimmerWidth:"150px"})}),e.jsx("p",{className:"text-[var(--text-muted)] text-[length:var(--font-100)]",children:e.jsx(j,{translationKey:"admin.featureFlags.subtitle",as:"span",shimmerWidth:"350px"})})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary inline-flex items-center gap-[var(--space-8)]",children:[e.jsx(U,{className:"h-[var(--space-16)] w-[var(--space-16)]"}),t("admin.featureFlags.button.addFlag")]})]}),e.jsxs("div",{className:"flex items-center gap-[var(--space-16)]",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(B,{className:"absolute left-[var(--space-12)] top-1/2 transform -translate-y-1/2 text-[var(--text-muted)] h-[var(--space-16)] w-[var(--space-16)]"}),e.jsx("input",{type:"text",placeholder:t("admin.featureFlags.search.placeholder"),value:v,onChange:a=>L(a.target.value),className:"field pl-[var(--space-32)] pr-[var(--space-16)]"})]}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-[var(--space-12)] top-1/2 transform -translate-y-1/2 text-[var(--text-muted)] h-[var(--space-16)] w-[var(--space-16)]"}),e.jsxs("select",{value:g,onChange:a=>M(a.target.value),className:"pl-[var(--space-32)] pr-[var(--space-24)] admin-select appearance-none",children:[e.jsx("option",{value:"all",children:t("admin.featureFlags.filter.all")}),e.jsx("option",{value:"section",children:t("admin.featureFlags.filter.sections")}),e.jsx("option",{value:"blog_post",children:t("admin.featureFlags.filter.blogPosts")}),e.jsx("option",{value:"project",children:t("admin.featureFlags.filter.projects")})]})]})]}),e.jsxs("div",{className:"bg-[var(--surface)] rounded-[var(--radius-md)] border border-[var(--border)] overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-[var(--surface-strong)]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.flagKey")}),e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.type")}),e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.description")}),e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.status")}),e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--border)]",children:F.map(a=>e.jsxs("tr",{className:"hover:bg-[var(--surface-strong)]/50",children:[e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)] whitespace-nowrap",children:e.jsx("div",{className:"text-[length:var(--font-100)] font-medium text-[var(--text)]",children:a.flag_key})}),e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)] whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-[length:var(--font-100)] font-semibold rounded-full bg-blue-100 text-blue-800",children:a.content_type})}),e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)]",children:e.jsx("div",{className:"text-[length:var(--font-100)] text-[var(--text-muted)] max-w-xs truncate",children:a.description})}),e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)] whitespace-nowrap",children:e.jsxs("button",{onClick:()=>K(a),className:"flex items-center gap-[var(--space-8)]",children:[a.enabled?e.jsx(Q,{className:"h-[var(--space-24)] w-[var(--space-24)] text-green-400"}):e.jsx(J,{className:"h-[var(--space-24)] w-[var(--space-24)] text-[var(--text-muted)]"}),e.jsx("span",{className:`text-[length:var(--font-100)] ${a.enabled?"text-green-400":"text-[var(--text-muted)]"}`,children:a.enabled?t("admin.featureFlags.status.enabled"):t("admin.featureFlags.status.disabled")})]})}),e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)] whitespace-nowrap text-[length:var(--font-100)] font-medium",children:e.jsxs("div",{className:"flex items-center gap-[var(--space-8)]",children:[e.jsx("button",{onClick:()=>q(a),className:"text-blue-400 hover:text-blue-300",children:e.jsx(H,{className:"h-[var(--space-16)] w-[var(--space-16)]"})}),e.jsx("button",{onClick:()=>O(a),className:"text-red-400 hover:text-red-300",children:e.jsx(Z,{className:"h-[var(--space-16)] w-[var(--space-16)]"})})]})})]},a.id))})]})}),F.length===0&&e.jsx("div",{className:"text-center py-8 text-[var(--text-muted)]",children:t("admin.featureFlags.empty.noFlags")})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[var(--surface)] rounded-[var(--radius-md)] p-[var(--space-24)] w-full max-w-md",children:[e.jsx("h3",{className:"text-[length:var(--font-400)] font-semibold text-[var(--text)] mb-4",children:t("admin.featureFlags.create")}),e.jsxs("div",{className:"stack [--stack-space:var(--space-16)]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.flagKey")}),e.jsx("input",{type:"text",value:s.flag_key,onChange:a=>r({...s,flag_key:a.target.value}),className:"field",placeholder:t("admin.featureFlags.flagKeyPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.contentType")}),e.jsxs("select",{value:s.content_type,onChange:a=>r({...s,content_type:a.target.value}),className:"admin-select w-full",children:[e.jsx("option",{value:"section",children:t("admin.featureFlags.contentType.section")}),e.jsx("option",{value:"blog_post",children:t("admin.featureFlags.contentType.blogPost")}),e.jsx("option",{value:"project",children:t("admin.featureFlags.contentType.project")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.contentId")}),e.jsx("input",{type:"text",value:s.content_id,onChange:a=>r({...s,content_id:a.target.value}),className:"field",placeholder:t("admin.featureFlags.form.contentIdPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.common.description")}),e.jsx("textarea",{value:s.description,onChange:a=>r({...s,description:a.target.value}),className:"field",rows:3,placeholder:t("admin.featureFlags.form.descriptionPlaceholder")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enabled",checked:s.enabled,onChange:a=>r({...s,enabled:a.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"enabled",className:"text-[length:var(--font-100)] text-[var(--text-muted)]",children:t("admin.featureFlags.form.enabledByDefault")})]})]}),e.jsxs("div",{className:"flex justify-end gap-[var(--space-12)] mt-[var(--space-24)]",children:[e.jsx("button",{onClick:()=>{u(!1),d()},className:"btn btn-secondary",children:t("admin.common.cancel")}),e.jsx("button",{onClick:E,className:"btn btn-primary",children:t("admin.common.create")})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[var(--surface)] rounded-[var(--radius-md)] p-[var(--space-24)] w-full max-w-md",children:[e.jsx("h3",{className:"text-[length:var(--font-400)] font-semibold text-[var(--text)] mb-4",children:t("admin.featureFlags.edit")}),e.jsxs("div",{className:"stack [--stack-space:var(--space-16)]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.flagKey")}),e.jsx("input",{type:"text",value:s.flag_key,onChange:a=>r({...s,flag_key:a.target.value}),className:"field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.contentType")}),e.jsxs("select",{value:s.content_type,onChange:a=>r({...s,content_type:a.target.value}),className:"admin-select w-full",children:[e.jsx("option",{value:"section",children:t("admin.featureFlags.contentType.section")}),e.jsx("option",{value:"blog_post",children:t("admin.featureFlags.contentType.blogPost")}),e.jsx("option",{value:"project",children:t("admin.featureFlags.contentType.project")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.contentId")}),e.jsx("input",{type:"text",value:s.content_id,onChange:a=>r({...s,content_id:a.target.value}),className:"field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.common.description")}),e.jsx("textarea",{value:s.description,onChange:a=>r({...s,description:a.target.value}),className:"field",rows:3})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"edit-enabled",checked:s.enabled,onChange:a=>r({...s,enabled:a.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"edit-enabled",className:"text-[length:var(--font-100)] text-[var(--text-muted)]",children:t("admin.featureFlags.form.enabled")})]})]}),e.jsxs("div",{className:"flex justify-end gap-[var(--space-12)] mt-[var(--space-24)]",children:[e.jsx("button",{onClick:()=>{h(!1),l(null),d()},className:"btn btn-secondary",children:t("admin.common.cancel")}),e.jsx("button",{onClick:P,className:"btn btn-primary",children:t("admin.common.update")})]})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[var(--surface)] rounded-[var(--radius-md)] p-[var(--space-24)] w-full max-w-md",children:[e.jsx("h3",{className:"text-[length:var(--font-400)] font-semibold text-[var(--text)] mb-4",children:t("admin.featureFlags.delete")}),e.jsx("p",{className:"text-[var(--text-muted)] mb-6",children:t("admin.featureFlags.confirm.deleteMessage").replace("{flagKey}",i?.flag_key||"")}),e.jsxs("div",{className:"flex justify-end gap-[var(--space-12)]",children:[e.jsx("button",{onClick:()=>{f(!1),l(null)},className:"btn btn-secondary",children:t("admin.common.cancel")}),e.jsx("button",{onClick:I,className:"btn inline-flex items-center justify-center bg-red-600 text-white hover:bg-red-700",children:t("admin.common.delete")})]})]})})]})}export{ce as FeatureFlagAdmin};
