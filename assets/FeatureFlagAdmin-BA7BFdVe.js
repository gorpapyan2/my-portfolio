import{c as T,A as E,B as f,D as L,_ as I,r as c,s as y,u as R,j as e,L as A,T as S,H as B,S as U}from"./index-jIcqUQKv.js";import{P as $,T as H}from"./trash-2-8Fj46AdX.js";import{F as Z}from"./filter-DHS_cYlX.js";const G=T("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);const J=T("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);const Q=T("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),V=E({flag_key:f().min(1,"Flag key is required").max(100,"Flag key must be less than 100 characters"),content_type:I(["section","blog_post","project"],{errorMap:()=>({message:"Content type must be section, blog_post, or project"})}),content_id:f().uuid().nullable().optional(),enabled:L().default(!0),description:f().min(1,"Description is required").max(500,"Description must be less than 500 characters")}),X=E({flag_key:f().min(1,"Flag key is required").max(100,"Flag key must be less than 100 characters").optional(),content_type:I(["section","blog_post","project"],{errorMap:()=>({message:"Content type must be section, blog_post, or project"})}).optional(),content_id:f().uuid().nullable().optional(),enabled:L().optional(),description:f().min(1,"Description is required").max(500,"Description must be less than 500 characters").optional()});function Y(){const[t,u]=c.useState([]),[N,h]=c.useState(!0),[F,g]=c.useState(null),m=c.useCallback(async()=>{try{h(!0),g(null);const{data:l,error:r}=await y.from("feature_flags").select("*").order("flag_key",{ascending:!0});if(r)throw r;u(l||[])}catch(l){console.error("Error loading feature flags:",l),g(l instanceof Error?l.message:"Failed to load feature flags")}finally{h(!1)}},[]),k=c.useCallback(async l=>{try{const r=V.parse(l),n=`temp-${Date.now()}`,d={id:n,...r,content_id:r.content_id??null,enabled:r.enabled??!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};u(i=>[...i,d]);const{data:x,error:p}=await y.from("feature_flags").insert(r).select().single();if(p)throw p;u(i=>i.map(s=>s.id===n?x:s))}catch(r){throw u(n=>n.filter(d=>!d.id.startsWith("temp-"))),console.error("Error creating feature flag:",r),r}},[]),v=c.useCallback(async(l,r)=>{try{const n=X.parse(r);u(p=>p.map(i=>i.id===l?{...i,...n}:i));const{data:d,error:x}=await y.from("feature_flags").update(n).eq("id",l).select().single();if(x)throw x;u(p=>p.map(i=>i.id===l?d:i))}catch(n){throw await m(),console.error("Error updating feature flag:",n),n}},[m]),w=c.useCallback(async l=>{try{u(n=>n.filter(d=>d.id!==l));const{error:r}=await y.from("feature_flags").delete().eq("id",l);if(r)throw r}catch(r){throw await m(),console.error("Error deleting feature flag:",r),r}},[m]),b=c.useCallback(async()=>{await m()},[m]),_=c.useCallback(l=>t.find(n=>n.flag_key===l)?.enabled??!1,[t]);return c.useEffect(()=>{m()},[m]),{featureFlags:t,isLoading:N,error:F,createFeatureFlag:k,updateFeatureFlag:v,deleteFeatureFlag:w,refreshFeatureFlags:b,isFeatureEnabled:_}}function se(){const{t}=R(),{featureFlags:u,isLoading:N,error:h,createFeatureFlag:F,updateFeatureFlag:g,deleteFeatureFlag:m}=Y(),[k,v]=c.useState(!1),[w,b]=c.useState(!1),[_,l]=c.useState(!1),[r,n]=c.useState(null),[d,x]=c.useState(""),[p,i]=c.useState("all"),[s,o]=c.useState({flag_key:"",content_type:"section",content_id:"",description:"",enabled:!0}),D=u.filter(a=>{const C=a.flag_key.toLowerCase().includes(d.toLowerCase())||a.description.toLowerCase().includes(d.toLowerCase()),z=p==="all"||a.content_type===p;return C&&z}),M=async()=>{try{const a={flag_key:s.flag_key,content_type:s.content_type,content_id:s.content_id||null,description:s.description,enabled:s.enabled};await F(a),v(!1),j()}catch(a){console.error("Error creating feature flag:",a)}},P=async()=>{if(r)try{const a={flag_key:s.flag_key,content_type:s.content_type,content_id:s.content_id||null,description:s.description,enabled:s.enabled};await g(r.id,a),b(!1),n(null),j()}catch(a){console.error("Error updating feature flag:",a)}},K=async()=>{if(r)try{await m(r.id),l(!1),n(null)}catch(a){console.error("Error deleting feature flag:",a)}},O=async a=>{try{await g(a.id,{enabled:!a.enabled})}catch(C){console.error("Error toggling feature flag:",C)}},q=a=>{n(a),o({flag_key:a.flag_key,content_type:a.content_type,content_id:a.content_id||"",description:a.description,enabled:a.enabled}),b(!0)},W=a=>{n(a),l(!0)},j=()=>{o({flag_key:"",content_type:"section",content_id:"",description:"",enabled:!0})};return N?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(A,{})}):h?e.jsx("div",{className:"text-center text-red-400",children:e.jsxs("p",{children:[e.jsx(S,{translationKey:"error.loadFailed.featureFlags",as:"span",shimmerWidth:"200px"}),": ",h]})}):e.jsxs("div",{className:"stack [--stack-space:var(--space-24)]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-[var(--space-12)]",children:[e.jsx("div",{className:"inline-flex p-[var(--space-8)] rounded-[var(--radius-md)] bg-accent/10 text-accent",children:e.jsx(B,{className:"h-[var(--space-24)] w-[var(--space-24)]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-[length:var(--font-600)] font-bold text-[var(--text)]",children:e.jsx(S,{translationKey:"admin.featureFlags.title",as:"span",shimmerWidth:"150px"})}),e.jsx("p",{className:"text-[var(--text-muted)] text-[length:var(--font-100)]",children:e.jsx(S,{translationKey:"admin.featureFlags.subtitle",as:"span",shimmerWidth:"350px"})})]})]}),e.jsxs("button",{onClick:()=>v(!0),className:"btn btn-primary inline-flex items-center gap-[var(--space-8)]",children:[e.jsx($,{className:"h-[var(--space-16)] w-[var(--space-16)]"}),t("admin.featureFlags.button.addFlag")]})]}),e.jsxs("div",{className:"flex items-center gap-[var(--space-16)]",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(U,{className:"absolute left-[var(--space-12)] top-1/2 transform -translate-y-1/2 text-[var(--text-muted)] h-[var(--space-16)] w-[var(--space-16)]"}),e.jsx("input",{type:"text",placeholder:t("admin.featureFlags.search.placeholder"),value:d,onChange:a=>x(a.target.value),className:"field pl-[var(--space-32)] pr-[var(--space-16)]"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-[var(--space-12)] top-1/2 transform -translate-y-1/2 text-[var(--text-muted)] h-[var(--space-16)] w-[var(--space-16)]"}),e.jsxs("select",{value:p,onChange:a=>i(a.target.value),className:"pl-[var(--space-32)] pr-[var(--space-24)] admin-select appearance-none",children:[e.jsx("option",{value:"all",children:t("admin.featureFlags.filter.all")}),e.jsx("option",{value:"section",children:t("admin.featureFlags.filter.sections")}),e.jsx("option",{value:"blog_post",children:t("admin.featureFlags.filter.blogPosts")}),e.jsx("option",{value:"project",children:t("admin.featureFlags.filter.projects")})]})]})]}),e.jsxs("div",{className:"bg-[var(--surface)] rounded-[var(--radius-md)] border border-[var(--border)] overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-[var(--surface-strong)]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.flagKey")}),e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.type")}),e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.description")}),e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.status")}),e.jsx("th",{className:"px-[var(--space-24)] py-[var(--space-12)] text-left text-[length:var(--font-100)] font-medium text-[var(--text-muted)] uppercase tracking-[var(--tracking-wide)]",children:t("admin.featureFlags.table.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--border)]",children:D.map(a=>e.jsxs("tr",{className:"hover:bg-[var(--surface-strong)]/50",children:[e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)] whitespace-nowrap",children:e.jsx("div",{className:"text-[length:var(--font-100)] font-medium text-[var(--text)]",children:a.flag_key})}),e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)] whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-[length:var(--font-100)] font-semibold rounded-full bg-blue-100 text-blue-800",children:a.content_type})}),e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)]",children:e.jsx("div",{className:"text-[length:var(--font-100)] text-[var(--text-muted)] max-w-xs truncate",children:a.description})}),e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)] whitespace-nowrap",children:e.jsxs("button",{onClick:()=>O(a),className:"flex items-center gap-[var(--space-8)]",children:[a.enabled?e.jsx(Q,{className:"h-[var(--space-24)] w-[var(--space-24)] text-green-400"}):e.jsx(J,{className:"h-[var(--space-24)] w-[var(--space-24)] text-[var(--text-muted)]"}),e.jsx("span",{className:`text-[length:var(--font-100)] ${a.enabled?"text-green-400":"text-[var(--text-muted)]"}`,children:a.enabled?t("admin.featureFlags.status.enabled"):t("admin.featureFlags.status.disabled")})]})}),e.jsx("td",{className:"px-[var(--space-24)] py-[var(--space-16)] whitespace-nowrap text-[length:var(--font-100)] font-medium",children:e.jsxs("div",{className:"flex items-center gap-[var(--space-8)]",children:[e.jsx("button",{onClick:()=>q(a),className:"text-blue-400 hover:text-blue-300",children:e.jsx(G,{className:"h-[var(--space-16)] w-[var(--space-16)]"})}),e.jsx("button",{onClick:()=>W(a),className:"text-red-400 hover:text-red-300",children:e.jsx(H,{className:"h-[var(--space-16)] w-[var(--space-16)]"})})]})})]},a.id))})]})}),D.length===0&&e.jsx("div",{className:"text-center py-8 text-[var(--text-muted)]",children:t("admin.featureFlags.empty.noFlags")})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[var(--surface)] rounded-[var(--radius-md)] p-[var(--space-24)] w-full max-w-md",children:[e.jsx("h3",{className:"text-[length:var(--font-400)] font-semibold text-[var(--text)] mb-4",children:t("admin.featureFlags.create")}),e.jsxs("div",{className:"stack [--stack-space:var(--space-16)]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.flagKey")}),e.jsx("input",{type:"text",value:s.flag_key,onChange:a=>o({...s,flag_key:a.target.value}),className:"field",placeholder:t("admin.featureFlags.flagKeyPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.contentType")}),e.jsxs("select",{value:s.content_type,onChange:a=>o({...s,content_type:a.target.value}),className:"admin-select w-full",children:[e.jsx("option",{value:"section",children:t("admin.featureFlags.contentType.section")}),e.jsx("option",{value:"blog_post",children:t("admin.featureFlags.contentType.blogPost")}),e.jsx("option",{value:"project",children:t("admin.featureFlags.contentType.project")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.contentId")}),e.jsx("input",{type:"text",value:s.content_id,onChange:a=>o({...s,content_id:a.target.value}),className:"field",placeholder:t("admin.featureFlags.form.contentIdPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.common.description")}),e.jsx("textarea",{value:s.description,onChange:a=>o({...s,description:a.target.value}),className:"field",rows:3,placeholder:t("admin.featureFlags.form.descriptionPlaceholder")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enabled",checked:s.enabled,onChange:a=>o({...s,enabled:a.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"enabled",className:"text-[length:var(--font-100)] text-[var(--text-muted)]",children:t("admin.featureFlags.form.enabledByDefault")})]})]}),e.jsxs("div",{className:"flex justify-end gap-[var(--space-12)] mt-[var(--space-24)]",children:[e.jsx("button",{onClick:()=>{v(!1),j()},className:"btn btn-secondary",children:t("admin.common.cancel")}),e.jsx("button",{onClick:M,className:"btn btn-primary",children:t("admin.common.create")})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[var(--surface)] rounded-[var(--radius-md)] p-[var(--space-24)] w-full max-w-md",children:[e.jsx("h3",{className:"text-[length:var(--font-400)] font-semibold text-[var(--text)] mb-4",children:t("admin.featureFlags.edit")}),e.jsxs("div",{className:"stack [--stack-space:var(--space-16)]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.flagKey")}),e.jsx("input",{type:"text",value:s.flag_key,onChange:a=>o({...s,flag_key:a.target.value}),className:"field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.contentType")}),e.jsxs("select",{value:s.content_type,onChange:a=>o({...s,content_type:a.target.value}),className:"admin-select w-full",children:[e.jsx("option",{value:"section",children:t("admin.featureFlags.contentType.section")}),e.jsx("option",{value:"blog_post",children:t("admin.featureFlags.contentType.blogPost")}),e.jsx("option",{value:"project",children:t("admin.featureFlags.contentType.project")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.featureFlags.form.contentId")}),e.jsx("input",{type:"text",value:s.content_id,onChange:a=>o({...s,content_id:a.target.value}),className:"field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:t("admin.common.description")}),e.jsx("textarea",{value:s.description,onChange:a=>o({...s,description:a.target.value}),className:"field",rows:3})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"edit-enabled",checked:s.enabled,onChange:a=>o({...s,enabled:a.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"edit-enabled",className:"text-[length:var(--font-100)] text-[var(--text-muted)]",children:t("admin.featureFlags.form.enabled")})]})]}),e.jsxs("div",{className:"flex justify-end gap-[var(--space-12)] mt-[var(--space-24)]",children:[e.jsx("button",{onClick:()=>{b(!1),n(null),j()},className:"btn btn-secondary",children:t("admin.common.cancel")}),e.jsx("button",{onClick:P,className:"btn btn-primary",children:t("admin.common.update")})]})]})}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[var(--surface)] rounded-[var(--radius-md)] p-[var(--space-24)] w-full max-w-md",children:[e.jsx("h3",{className:"text-[length:var(--font-400)] font-semibold text-[var(--text)] mb-4",children:t("admin.featureFlags.delete")}),e.jsx("p",{className:"text-[var(--text-muted)] mb-6",children:t("admin.featureFlags.confirm.deleteMessage").replace("{flagKey}",r?.flag_key||"")}),e.jsxs("div",{className:"flex justify-end gap-[var(--space-12)]",children:[e.jsx("button",{onClick:()=>{l(!1),n(null)},className:"btn btn-secondary",children:t("admin.common.cancel")}),e.jsx("button",{onClick:K,className:"btn inline-flex items-center justify-center bg-red-600 text-white hover:bg-red-700",children:t("admin.common.delete")})]})]})})]})}export{se as FeatureFlagAdmin};
