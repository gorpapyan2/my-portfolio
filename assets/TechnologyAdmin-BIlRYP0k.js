import{A as G,B as c,K as te,_ as U,M as R,u as ae,r as s,s as p,j as e,T as B,y as re}from"./index-DiO0CGqv.js";import{P as K,T as se}from"./trash-2-BQk5RIGf.js";import{S as le}from"./square-pen-BWLj_Xzz.js";const O=G({slug:c().min(1,"Slug is required").max(100,"Slug too long"),language:U(["en","ru","am"],{errorMap:()=>({message:"Language must be en, ru, or am"})}),title:c().min(1,"Title is required").max(200,"Title too long"),description:c().min(1,"Description is required").max(1e3,"Description too long"),category:c().min(1,"Category is required").max(100,"Category too long"),level:te().int().min(0,"Level must be at least 0").max(100,"Level must be at most 100"),icon_name:c().optional()});O.partial();const D=G({technology_id:c().uuid("Invalid UUID"),language:U(["en","ru","am"],{errorMap:()=>({message:"Language must be en, ru, or am"})}),detailed_description:R(c()).min(1,"At least one detailed description is required"),tags:R(c()).min(1,"At least one tag is required"),real_world_example:c().min(1,"Real world example is required").max(2e3,"Example too long")});D.partial();const ie=["Code2","GitBranch","Workflow","Kanban","Database","Bug","Globe","Lightbulb","Smartphone","Table"],P=v=>v.split(`
`).map(l=>l.trim()).filter(Boolean),W=v=>v.split(/[,\\n]/).map(l=>l.trim()).filter(Boolean);function ce({onClose:v}){const{t:l,language:X}=ae(),[m,T]=s.useState(X),[_,z]=s.useState([]),[w,H]=s.useState({}),[J,q]=s.useState(!0),[L,F]=s.useState(null),[Q,j]=s.useState(!1),[b,M]=s.useState(null),[i,g]=s.useState({slug:"",title:"",description:"",category:"",level:0,icon_name:"Code2"}),[$,y]=s.useState(""),[k,C]=s.useState(""),[A,f]=s.useState({detailed_description:[],tags:[],real_world_example:""}),[n,E]=s.useState({}),[d,S]=s.useState({}),N=s.useCallback(async()=>{try{q(!0),F(null);const[t,a]=await Promise.all([p.from("technologies").select("*").eq("language",m).order("created_at",{ascending:!0}),p.from("technology_details").select("*").eq("language",m)]);if(t.error)throw t.error;if(a.error)throw a.error;const r={};(a.data||[]).forEach(o=>{r[o.technology_id]=o}),z(t.data||[]),H(r)}catch(t){const a=t instanceof Error?t.message:"Failed to load technologies";console.error("Error loading technologies:",t),F(a)}finally{q(!1)}},[m]);s.useEffect(()=>{N()},[N]);const I=()=>{M(null),g({slug:"",title:"",description:"",category:"",level:0,icon_name:"Code2"}),y(""),C(""),f({detailed_description:[],tags:[],real_world_example:""}),E({}),S({})},V=t=>{const a=w[t.id];M(t),g({slug:t.slug,title:t.title,description:t.description,category:t.category,level:t.level,icon_name:t.icon_name??"Code2"}),y((a?.detailed_description||[]).join(`
`)),C((a?.tags||[]).join(", ")),f({detailed_description:a?.detailed_description||[],tags:a?.tags||[],real_world_example:a?.real_world_example??""}),j(!0)},Y=async t=>{if(confirm(l("admin.common.confirmDelete")))try{const{error:a}=await p.from("technologies").delete().eq("id",t);if(a)throw a;await N()}catch(a){console.error("Error deleting technology:",a),alert(l("admin.error.deleteFailed"))}},Z=async t=>{t.preventDefault(),E({}),S({});const a={detailed_description:P($),tags:W(k),real_world_example:A.real_world_example.trim()};try{const r=O.parse({...i,language:m,level:Number(i.level||0),icon_name:i.icon_name||void 0});if(b){const{error:o}=await p.from("technologies").update({slug:r.slug,title:r.title,description:r.description,category:r.category,level:r.level,icon_name:r.icon_name}).eq("id",b.id);if(o)throw o;const h=D.parse({technology_id:b.id,language:m,...a}),{error:x}=await p.from("technology_details").upsert(h,{onConflict:"technology_id,language"});if(x)throw x}else{const{data:o,error:h}=await p.from("technologies").insert(r).select().single();if(h)throw h;if(!o)throw new Error("Failed to create technology");const x=D.parse({technology_id:o.id,language:m,...a}),{error:u}=await p.from("technology_details").upsert(x,{onConflict:"technology_id,language"});if(u)throw u}j(!1),I(),await N()}catch(r){if(r instanceof Error&&"issues"in r){const o={},h={};r.issues.forEach(x=>{const u=x.path[0];u==="detailed_description"||u==="tags"||u==="real_world_example"?h[String(u)]=x.message:o[String(u)]=x.message}),E(o),S(h)}else console.error("Error saving technology:",r),alert(l("admin.error.saveFailed"))}},ee=s.useMemo(()=>_.map(t=>({technology:t,detail:w[t.id]})),[_,w]);return J?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(B,{translationKey:"admin.common.loading",as:"div",shimmerWidth:"120px",className:"text-[var(--text)]"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-[length:var(--font-600)] font-semibold text-[var(--text)]",children:e.jsx(B,{translationKey:"technologies.title",as:"span",shimmerWidth:"220px"})}),e.jsx("button",{onClick:v,className:"p-2 text-[var(--text-muted)] hover:text-[var(--text)] transition-colors",children:"X"})]}),L&&e.jsx("div",{className:"text-red-400 text-[length:var(--font-100)] mb-4",children:L}),Q?e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:l("admin.common.language")}),e.jsxs("select",{value:m,onChange:t=>T(t.target.value),className:"field",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ru",children:"Russian"}),e.jsx("option",{value:"am",children:"Armenian"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Slug"}),e.jsx("input",{type:"text",value:i.slug??"",onChange:t=>g({...i,slug:t.target.value}),className:`field ${n.slug?"border-red-500":"border-[var(--border)]"}`,required:!0}),n.slug&&e.jsx("p",{className:"text-red-400 text-[length:var(--font-100)] mt-1",children:n.slug})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Title"}),e.jsx("input",{type:"text",value:i.title??"",onChange:t=>g({...i,title:t.target.value}),className:`field ${n.title?"border-red-500":"border-[var(--border)]"}`,required:!0}),n.title&&e.jsx("p",{className:"text-red-400 text-[length:var(--font-100)] mt-1",children:n.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("input",{type:"text",value:i.category??"",onChange:t=>g({...i,category:t.target.value}),className:`field ${n.category?"border-red-500":"border-[var(--border)]"}`,required:!0}),n.category&&e.jsx("p",{className:"text-red-400 text-[length:var(--font-100)] mt-1",children:n.category})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:l("admin.common.description")}),e.jsx("textarea",{value:i.description??"",onChange:t=>g({...i,description:t.target.value}),rows:3,className:`field ${n.description?"border-red-500":"border-[var(--border)]"}`,required:!0}),n.description&&e.jsx("p",{className:"text-red-400 text-[length:var(--font-100)] mt-1",children:n.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Icon"}),e.jsx("select",{value:i.icon_name??"Code2",onChange:t=>g({...i,icon_name:t.target.value}),className:"admin-select w-full",children:ie.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Level"}),e.jsx("input",{type:"number",value:i.level??0,onChange:t=>g({...i,level:parseInt(t.target.value,10)||0}),className:`field ${n.level?"border-red-500":"border-[var(--border)]"}`,min:"0",max:"100",required:!0}),n.level&&e.jsx("p",{className:"text-red-400 text-[length:var(--font-100)] mt-1",children:n.level})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Detailed description (one per line)"}),e.jsx("textarea",{value:$,onChange:t=>{y(t.target.value),f(a=>({...a,detailed_description:P(t.target.value)}))},rows:4,className:`field ${d.detailed_description?"border-red-500":"border-[var(--border)]"}`,required:!0}),d.detailed_description&&e.jsx("p",{className:"text-red-400 text-[length:var(--font-100)] mt-1",children:d.detailed_description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Tags (comma or line separated)"}),e.jsx("textarea",{value:k,onChange:t=>{C(t.target.value),f(a=>({...a,tags:W(t.target.value)}))},rows:2,className:`field ${d.tags?"border-red-500":"border-[var(--border)]"}`,required:!0}),d.tags&&e.jsx("p",{className:"text-red-400 text-[length:var(--font-100)] mt-1",children:d.tags})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Real world example"}),e.jsx("textarea",{value:A.real_world_example,onChange:t=>f(a=>({...a,real_world_example:t.target.value})),rows:3,className:`field ${d.real_world_example?"border-red-500":"border-[var(--border)]"}`,required:!0}),d.real_world_example&&e.jsx("p",{className:"text-red-400 text-[length:var(--font-100)] mt-1",children:d.real_world_example})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{j(!1),I()},className:"btn btn-secondary",children:l("admin.common.cancel")}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 btn btn-primary",children:[e.jsx(K,{className:"h-4 w-4"}),l(b?"admin.common.save":"admin.common.add")]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-6",children:[e.jsxs("h3",{className:"text-[length:var(--font-400)] font-medium text-[var(--text)]",children:[l("technologies.title")," (",_.length,")"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:m,onChange:t=>T(t.target.value),className:"field",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ru",children:"Russian"}),e.jsx("option",{value:"am",children:"Armenian"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"inline-flex items-center gap-2 btn btn-primary",children:[e.jsx(K,{className:"h-4 w-4"}),l("admin.common.add")]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ee.map(({technology:t,detail:a})=>{const r=re(t.icon_name??"");return e.jsxs("div",{className:"p-4 bg-[var(--surface)] rounded-[var(--radius-md)] border border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-[var(--radius-md)] bg-accent/10 text-accent",children:e.jsx(r,{className:"h-4 w-4"})}),e.jsx("h4",{className:"text-[length:var(--font-400)] font-medium text-[var(--text)]",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>V(t),className:"p-1 text-[var(--text-muted)] hover:text-[var(--text)] transition-colors",children:e.jsx(le,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>Y(t.id),className:"p-1 text-[var(--text-muted)] hover:text-red-400 transition-colors",children:e.jsx(se,{className:"h-3 w-3"})})]})]}),e.jsx("p",{className:"text-[var(--text-muted)] text-[length:var(--font-100)] mb-3",children:t.description}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(a?.tags||[]).map(o=>e.jsx("span",{className:"px-[var(--space-8)] py-[var(--space-4)] bg-[var(--surface-strong)] text-[var(--text)] text-[length:var(--font-100)] rounded-full",children:o},o))}),e.jsxs("div",{className:"text-[length:var(--font-100)] text-[var(--text-muted)]",children:[l("proficiency")," ",t.level,"% Â· ",t.category]})]},t.id)})})]})]})}export{ce as TechnologyAdmin};
