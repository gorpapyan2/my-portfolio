import{s as z,t as u,a7 as X,_ as J,a5 as O,r as o,v as y,u as Y,j as t,T as Z}from"./index-siMbvs9L.js";import{T as ee}from"./trash-2-ClcjC_9b.js";import{g as te}from"./iconMap-CwtlYKFi.js";import{A as ae,F as W,T as R,S as re,a as se,b as oe}from"./AdminToolbar-O7s0lh2N.js";import{A as ie,L as le}from"./AdminLoadingState-BlNnS30Y.js";import{S as ne}from"./square-pen-BtczubbV.js";import"./code-2-Uh6hYNEL.js";import"./plus-YjYhcHqF.js";const Q=z({slug:u().min(1,"Slug is required").max(100,"Slug too long"),language:J(["en","ru","am"],{errorMap:()=>({message:"Language must be en, ru, or am"})}),title:u().min(1,"Title is required").max(200,"Title too long"),description:u().min(1,"Description is required").max(1e3,"Description too long"),category:u().min(1,"Category is required").max(100,"Category too long"),level:X().int().min(0,"Level must be at least 0").max(100,"Level must be at most 100"),icon_name:u().optional()});Q.partial();const H=z({technology_id:u().uuid("Invalid UUID"),language:J(["en","ru","am"],{errorMap:()=>({message:"Language must be en, ru, or am"})}),detailed_description:O(u()).min(1,"At least one detailed description is required"),tags:O(u()).min(1,"At least one tag is required"),real_world_example:u().min(1,"Real world example is required").max(2e3,"Example too long")});H.partial();const de=n=>n.split(`
`).map(a=>a.trim()).filter(Boolean),ce=n=>n.split(/[,\n]/).map(a=>a.trim()).filter(Boolean);function me(n){const[a,G]=o.useState(n),[S,q]=o.useState([]),[v,K]=o.useState({}),[F,A]=o.useState(!0),[k,M]=o.useState(null),[l,c]=o.useState(!1),[f,B]=o.useState(null),[_,T]=o.useState({slug:"",title:"",description:"",category:"",level:0,icon_name:"Code2"}),[C,b]=o.useState(""),[m,w]=o.useState(""),[D,E]=o.useState({detailed_description:[],tags:[],real_world_example:""}),[P,L]=o.useState({}),[U,N]=o.useState({}),p=o.useCallback(async()=>{try{A(!0),M(null);const[r,i]=await Promise.all([y.from("technologies").select("*").eq("language",a).order("created_at",{ascending:!0}),y.from("technology_details").select("*").eq("language",a)]);if(r.error)throw r.error;if(i.error)throw i.error;const s={};(i.data||[]).forEach(d=>{s[d.technology_id]=d}),q(r.data||[]),K(s)}catch(r){const i=r instanceof Error?r.message:"Failed to load technologies";console.error("Error loading technologies:",r),M(i)}finally{A(!1)}},[a]);o.useEffect(()=>{p()},[p]);const e=o.useCallback(()=>{B(null),T({slug:"",title:"",description:"",category:"",level:0,icon_name:"Code2"}),b(""),w(""),E({detailed_description:[],tags:[],real_world_example:""}),L({}),N({})},[]),g=o.useCallback(r=>{const i=v[r.id];B(r),T({slug:r.slug,title:r.title,description:r.description,category:r.category,level:r.level,icon_name:r.icon_name??"Code2"}),b((i?.detailed_description||[]).join(`
`)),w((i?.tags||[]).join(", ")),E({detailed_description:i?.detailed_description||[],tags:i?.tags||[],real_world_example:i?.real_world_example??""}),c(!0)},[v]),$=o.useCallback(async(r,i)=>{if(confirm(i))try{const{error:s}=await y.from("technologies").delete().eq("id",r);if(s)throw s;await p()}catch(s){throw console.error("Error deleting technology:",s),s}},[p]),I=o.useCallback(async r=>{r.preventDefault(),L({}),N({});const i={detailed_description:de(C),tags:ce(m),real_world_example:D.real_world_example.trim()};try{const s=Q.parse({..._,language:a,level:Number(_.level||0),icon_name:_.icon_name||void 0});if(f){const{error:d}=await y.from("technologies").update({slug:s.slug,title:s.title,description:s.description,category:s.category,level:s.level,icon_name:s.icon_name}).eq("id",f.id);if(d)throw d;const j=H.parse({technology_id:f.id,language:a,...i}),{error:h}=await y.from("technology_details").upsert(j,{onConflict:"technology_id,language"});if(h)throw h}else{const{data:d,error:j}=await y.from("technologies").insert(s).select().single();if(j)throw j;if(!d)throw new Error("Failed to create technology");const h=H.parse({technology_id:d.id,language:a,...i}),{error:x}=await y.from("technology_details").upsert(h,{onConflict:"technology_id,language"});if(x)throw x}c(!1),e(),await p()}catch(s){if(s instanceof Error&&"issues"in s){const d={},j={};s.issues.forEach(h=>{const x=h.path[0];x==="detailed_description"||x==="tags"||x==="real_world_example"?j[String(x)]=h.message:d[String(x)]=h.message}),L(d),N(j)}else throw console.error("Error saving technology:",s),s}},[a,D.real_world_example,C,f,_,p,e,m]),V=o.useMemo(()=>S.map(r=>({technology:r,detail:v[r.id]})),[S,v]);return{activeLanguage:a,setActiveLanguage:G,technologies:S,detailsMap:v,isLoading:F,errorMessage:k,showEditor:l,setShowEditor:c,editingTechnology:f,formData:_,setFormData:T,detailText:C,setDetailText:b,tagsText:m,setTagsText:w,detailData:D,setDetailData:E,errors:P,detailErrors:U,technologiesWithDetails:V,handleEdit:g,handleDelete:$,handleSubmit:I,resetForm:e}}const ge=["Code2","GitBranch","Workflow","Kanban","Database","Bug","Globe","Lightbulb","Smartphone","Table"],ue=n=>n.split(`
`).map(a=>a.trim()).filter(Boolean),pe=n=>n.split(/[,\n]/).map(a=>a.trim()).filter(Boolean);function ye({onClose:n}){const{t:a,language:G}=Y(),{activeLanguage:S,setActiveLanguage:q,technologies:v,isLoading:K,errorMessage:F,showEditor:A,setShowEditor:k,editingTechnology:M,formData:l,setFormData:c,detailText:f,setDetailText:B,tagsText:_,setTagsText:T,detailData:C,setDetailData:b,errors:m,detailErrors:w,technologiesWithDetails:D,handleEdit:E,handleDelete:P,handleSubmit:L,resetForm:U}=me(G),N=async e=>{try{await P(e,a("admin.common.confirmDelete"))}catch{alert(a("admin.error.deleteFailed"))}},p=async e=>{try{await L(e)}catch{alert(a("admin.error.saveFailed"))}};return K?t.jsx(ie,{shimmerWidth:"120px"}):t.jsxs("div",{children:[t.jsx(ae,{title:t.jsx(Z,{translationKey:"technologies.title",as:"span",shimmerWidth:"220px"}),onClose:n}),F&&t.jsx("div",{className:"text-red-400 text-[length:var(--font-100)] mb-4",children:F}),A?t.jsxs("form",{onSubmit:p,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(le,{value:S,onChange:q,label:a("admin.common.language")}),t.jsx(W,{label:"Slug",value:l.slug??"",onChange:e=>c({...l,slug:e}),error:m.slug,required:!0})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(W,{label:"Title",value:l.title??"",onChange:e=>c({...l,title:e}),error:m.title,required:!0}),t.jsx(W,{label:"Category",value:l.category??"",onChange:e=>c({...l,category:e}),error:m.category,required:!0})]}),t.jsx(R,{label:a("admin.common.description"),value:l.description??"",onChange:e=>c({...l,description:e}),error:m.description,rows:3,required:!0}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(re,{label:"Icon",value:l.icon_name??"Code2",onChange:e=>c({...l,icon_name:e}),options:ge.map(e=>({value:e,label:e}))}),t.jsx(W,{type:"number",label:"Level",value:l.level??0,onChange:e=>c({...l,level:parseInt(e,10)||0}),error:m.level,min:0,max:100,required:!0})]}),t.jsx(R,{label:"Detailed description (one per line)",value:f,onChange:e=>{B(e),b(g=>({...g,detailed_description:ue(e)}))},error:w.detailed_description,rows:4,required:!0}),t.jsx(R,{label:"Tags (comma or line separated)",value:_,onChange:e=>{T(e),b(g=>({...g,tags:pe(e)}))},error:w.tags,rows:2,required:!0}),t.jsx(R,{label:"Real world example",value:C.real_world_example,onChange:e=>b(g=>({...g,real_world_example:e})),error:w.real_world_example,rows:3,required:!0}),t.jsx(se,{onCancel:()=>{k(!1),U()},submitLabel:a(M?"admin.common.save":"admin.common.add"),cancelLabel:a("admin.common.cancel")})]}):t.jsxs(t.Fragment,{children:[t.jsx(oe,{title:a("technologies.title"),itemCount:v.length,activeLanguage:S,onLanguageChange:q,onAdd:()=>k(!0),addButtonLabel:a("admin.common.add")}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.map(({technology:e,detail:g})=>{const $=te(e.icon_name??"");return t.jsxs("div",{className:"p-4 bg-[var(--surface)] rounded-[var(--radius-md)] border border-[var(--border)]",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 rounded-[var(--radius-md)] bg-accent/10 text-accent",children:t.jsx($,{className:"h-4 w-4"})}),t.jsx("h4",{className:"text-[length:var(--font-400)] font-medium text-[var(--text)]",children:e.title})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>E(e),className:"p-1 text-[var(--text-muted)] hover:text-[var(--text)] transition-colors",children:t.jsx(ne,{className:"h-3 w-3"})}),t.jsx("button",{onClick:()=>N(e.id),className:"p-1 text-[var(--text-muted)] hover:text-red-400 transition-colors",children:t.jsx(ee,{className:"h-3 w-3"})})]})]}),t.jsx("p",{className:"text-[var(--text-muted)] text-[length:var(--font-100)] mb-3",children:e.description}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(g?.tags||[]).map(I=>t.jsx("span",{className:"px-[var(--space-8)] py-[var(--space-4)] bg-[var(--surface-strong)] text-[var(--text)] text-[length:var(--font-100)] rounded-full",children:I},I))}),t.jsxs("div",{className:"text-[length:var(--font-100)] text-[var(--text-muted)]",children:[a("proficiency")," ",e.level,"% Â· ",e.category]})]},e.id)})})]})]})}export{ye as TechnologyAdmin};
